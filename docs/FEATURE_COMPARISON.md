# qBit Smart Web v1.10 vs main.py v11.0.0 PRO 功能对比

## 📊 功能对比表

| 功能 | main.py v11.0.0 PRO | qBit Smart Web v1.10 | 状态 |
|------|---------------------|----------------------|------|
| **核心限速** | | | |
| PID控制器 | ✅ 完整实现 | ✅ 完整实现 | ✅ |
| Kalman滤波 | ✅ 完整实现 | ✅ 完整实现 | ✅ |
| 四阶段控制 (warmup/catch/steady/finish) | ✅ | ✅ | ✅ |
| 动态参数调整 | ✅ | ✅ | ✅ |
| 多窗口速度加权 | ✅ | ⚠️ 简化版 | ⚠️ |
| **状态持久化** | | | |
| 种子状态保存到数据库 | ✅ 每3分钟 | ❌ 无 | ❌ 缺失 |
| 重启后恢复限速状态 | ✅ load_from_db | ❌ 无 | ❌ 缺失 |
| 统计数据持久化 | ✅ | ❌ 无 | ❌ 缺失 |
| **Telegram** | | | |
| 通知发送 | ✅ | ✅ | ✅ |
| 双向命令交互 | ✅ /status /pause /resume | ❌ 无 | ❌ 缺失 |
| 配置热修改 | ✅ /setspeed | ❌ 无 | ⚠️ Web界面可改 |
| **PT站点辅助** | | | |
| U2专用辅助 | ✅ | ✅ | ✅ |
| 通用NexusPHP站点 | ❌ 仅U2 | ✅ 全站点 | ✅ 更优 |
| TID搜索 | ✅ | ✅ | ✅ |
| 促销检测 | ✅ | ✅ | ✅ |
| Cookie有效性检测 | ✅ 自动定期检查 | ⚠️ 手动检查 | ⚠️ |
| **下载限速** | | | |
| 下载即将完成时限速 | ✅ | ✅ | ✅ |
| **汇报优化** | | | |
| 智能汇报时机 | ✅ | ✅ | ✅ |
| **RSS抓取** | | | |
| RSS自动抓取 | ❌ 无 | ✅ | ✅ 新增 |
| **自动删种** | | | |
| 自动删种引擎 | ❌ 无 | ✅ 8个内置规则 | ✅ 新增 |
| 删前强制汇报 | N/A | ✅ | ✅ |
| **多实例管理** | | | |
| 多qBittorrent实例 | ❌ 单实例 | ✅ | ✅ 新增 |
| 按空间分配种子 | ❌ | ✅ | ✅ 新增 |
| **Web界面** | | | |
| 可视化界面 | ❌ 无 | ✅ | ✅ 新增 |
| 响应式设计 | ❌ | ✅ | ✅ |

## ❌ v1.10 缺失的重要功能

### 1. 种子限速状态持久化（重要！）

**main.py 实现：**
```python
# 数据库表 torrent_states 保存:
# - 周期索引、周期开始时间
# - 已上传量、同步状态
# - TID、促销信息等

# 重启后恢复:
db_data = self.db.load_torrent_state(h)
if db_data:
    state.load_from_db(db_data)
    logger.info(f"📦 恢复种子状态: {torrent.name}")
```

**v1.10 现状：**
- `_states` 字典只在内存中
- 重启后所有限速状态丢失
- 种子需要重新预热，可能导致超速

### 2. Telegram双向交互

**main.py 支持的命令：**
- `/status` - 查看状态
- `/pause` - 暂停限速
- `/resume` - 恢复限速
- `/setspeed <速度>` - 动态设置目标速度
- `/log` - 查看日志

**v1.10 现状：**
- 只有单向通知
- 无法通过TG控制

### 3. Cookie自动定期检查

**main.py：**
```python
COOKIE_CHECK_INTERVAL = 3600  # 每小时检查
# 自动检测Cookie失效并发送告警
```

**v1.10：**
- 只有手动检查按钮

## 🔧 建议添加到v1.10的功能

### 优先级高
1. **种子状态持久化** - 防止重启丢失状态
2. **统计数据持久化** - 记录历史周期成功率

### 优先级中
3. **Telegram命令交互** - 远程控制
4. **Cookie定期自动检查** - 提前预警

### 优先级低
5. **多窗口速度加权完整实现**
6. **日志环形缓冲区**
